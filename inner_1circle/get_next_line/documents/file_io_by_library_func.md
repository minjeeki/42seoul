# 표준 라이브러리 함수를 이용한 파일 입출력

표준 라이브러리 함수를 통해 파일 입출력을 하는 것은 시스템 호출 함수를 래핑한 형태이다.

* 함수 내부에서 메모리의 할당 및 해제가 일어난다.

* 잦은 커널 호출로 인한 성능 손실을 줄이기 위해 입력을 모았다가 한번에 커널에 요청하기도 한다.

* 시스템 호출 함수가 정상 동작한 뒤 파일 디스크립터를 반환하는 반면, 라이브러리 함수는 정상 동작의 결과로 파일 포인터를 반환한다.

* 파일 입출력 함수에서 에러가 발생하는 경우 : 파일 열기 단계에서 mode 설정한 것과 다른 방식으로 파일을 입출력할 때 에러가 발생함 (읽기 모드로 열고 쓰기 진행 등)

## 01 > 파일 열기/닫기 함수

fopen() 함수를 통해 파일을 열었다면 fclose(), _fcloseall() 함수로 파일을 닫아 열어둔 파일에 대한 자원을 해제해야 한다.

* 파일을 열고 닫지 않았다면, 운영체제의 커널 영역에서 파일을 붙들고 놔주지 않는 등의 (대개 비동기 파일 입출력 시도 시 발생) 특별한 일이 없는 한 운영체제가 모든 파일을 닫으나, 개발자가 스스로 처리하는 것이 바람직하다.

### fopen() : 파일을 여는 함수

특정 경로에 있는 파일을 열어서 접근할 수 있도록 FILE 구조체에 대한 주소를 반환하는 함수

* 프로토 타입

	``` C
	FILE *fopen(const char *filename, const char *mode);
	```

* 인자

	* filename : 열고자하는 대상 파일의 절대 경로 문자열

	* mode : 접근 모드를 명시한 문자열

		<details>
		<summary> 접근 모드 문자열 형태 </summary>

		: 파일의 모드(텍스트/바이너리)와 접근 방법(읽기/쓰기) 등에 대한 정보를 표시한 문자 조합

		* 텍스트 파일 읽기 (`r`), 쓰기 (`w`), 추가 (`a`)

		* 읽기 모드의 경우 파일이 기존에 존재하는 경우에는 파일을 열어주나, 없을 경우에는 에러를 발생시킨다.

		* 쓰기와 추가 모드의 경우 파일이 기존에 존재하는 경우에는 기존 내용을 지우고 열어서 쓰거나 기존 내용 뒤에 추가하는데, 없을 경우에는 새로 만들어서 쓰기와 추가 제어를 한다.

		* 바이너리 파일의 경우에는 각각의 문자에 `b` 문자를 붙여서 표현한다.

		* 파일 제어 중 갱신이 필요한 경우, 각각의 문자에 `+` 문자를 붙여서 표현한다. 

		</details>

* 반환값

	* 정상 출력 : FILE 구조체에 대한 주소(포인터)

	* 에러 발생 : NULL

### fclose() : 파일을 닫는 함수

fopen() 함수를 통해서 열어둔 파일에 대한 입출력 작업을 모두 종료한 뒤 자원을 해제하고 닫음

* 프로토 타입

	```C
	int fclose(FILE *stream)
	```

* 인자

	* stream : 닫을 파일에 대한 FILE 구조체의 주소 (fopen 함수의 정상 작동 반환값)

* 반환값

	* 성공 : 0

	* 에러 : EOF (End Of file = -1)

### fcloseall() : 모든 파일을 닫는 함수

프로그램에서 열어둔 모든 파일을 닫음

* 프로토 타입

	```C
	int _fcloseall(void)
	```

* 반환값 : 닫은 파일의 개수

* FILE 포인터를 알 수 없다 하더라도 한번에 닫을 수 있다.

## 02 > 파일 쓰기 (출력) 함수

* 문자 하나를 쓰기에 적합한 파일 출력 함수 : fprintf(), fputc(), fwrite()

* 한 행의 문자열을 쓰기에 적합한 파일 출력 함수 : fputs()

### fprintf() : 텍스트 파일 출력 함수

형식 문자열에 맞춰 대상 파일에 형식화된 문자열 출력하는(쓰는) 함수

* fprintf()의 첫번째 인자를 stdout으로 변경할 경우 printf() 함수의 동작과 동일한 결과로, 콘솔 화면에 문자열을 출력할 수 있다 (그 외의 상황에서는 문자열을 디스크에 기록함)

* 함수 프로토 타입

	``` C
	int fprintf(FILE *stream, const char *format [, argument ]...);
	```

* 인자

	* stream : FILE 구조체에 대한 포인터

	* format : 형식 문자열이 저장된 메모리 주소

	* [, argument] : 형식 문자열에 대응하는 가변 인자들

* 반환값 : 출력된 바이트 수

### fputc() : 문자 하나를 읽어 파일에 쓰는 텍스트 파일 출력 함수

* 함수 프로토 타입

	```C
	int fputc(int c, FILE *stream);
	```

* 인자

	* c : 파일에 쓸 문자
	
	* stream : FILE 구조체에 대한 포인터

* 반환값

	* 정상 출력 : 파일에 쓴 문자

	* 에러 : EOF (-1)

### fwrite() : 바이너리 모드로 대상 파일에 정보를 쓰는 파일 출력 함수

* 항수 프로토 타입

	```C
	size_t fwrite(const void *buffer, size_t size, size_t count, FILE *stream);
	```

* 인자

	* buffer : 파일에 쓸 내용이 저장된 버퍼의 주소

	* size : 한번에 쓰고자 하는 메모리 블록의 크기

	* count : 쓰고자 하는 메모리 블록의 수

	* stream : FILE 구조체에 대한 포인터

* 반환값 : 쓰기에 성공한 메모리 블록의 수

* 입출력의 단위로 구조체를 사용해 구조체 덩어리 통째로 저장할 수도 있음

	* 장점 : 처리 속도가 빠르고 개발이 편리해질 수 있음

	* 단점 : 문자열 처리 후 행 단위 저장하는 방식에 비해 메모리 낭비가 발생할 수 있음

### fputs() : 대상 파일에 대한 문자열 한 줄을 쓸 수 있는 출력 함수

* 함수 프로토 타입

	```C
	int fputs(const char *string, FILE *stream);
	```
* 인자

	* string : 출력할 문자열이 저장될 기억 공간의 주소

	* stream : FILE 구조체에 대한 포인터

* 반환값

	* 정상 : 음수가 아닌 값 반환

	* 에러 : EOF (-1) 반환

## 03 > 파일 읽기 함수

* 문자 하나를 읽기에 적합한 파일 출력 함수 : fscanf(), fgetc(), fread()

* 한 행의 문자열을 읽기에 적합한 파일 출력 함수 : fgets()

### fscanf() : 텍스트 파일 입력 함수

형식 문자열에 맞춰 파일로부터 정보를 읽어들이는 함수

* fscanf의 첫번째 인자를 stdin으로 변경할 경우 scanf() 함수의 동작과 동일하며, 보안 결함에 있어서도 같은 문제점이 있다.

* 대개 단어 하나를 읽는데는 문제가 없으나 문장 전체를 읽어오는데 사용하는 것은 바람직하지 않기에 fgets() 함수를 사용하는 편이다.

* 함수 프로토 타입

	``` C
	int fscanf(FILE *stream, const char *format [,argument]...);
	```

* 인자

	* stream : FILE 구조체에 대한 포인터

	* format : 형식 문자열이 저장된 메모리의 주소

	* [, argument] : 형식 문자열에 대응하는 가변 인자들 (정보가 저장될 기억 공간의 주소)

* 반환값 : 성공적으로 읽어들인 항목(field)의 개수

### fgetc() : 대상 파일로부터 문자 하나를 읽어들이는 입력 함수

* 함수 프로토 타입

	```C
	int fputs(char *stream);
	```

* 인자

	* stream : 파일 구조체에 대한 포인터

* 반환값

	* 정상 : 파일에서 읽은 문자

	* 에러 : EOF (-1)

### fread() : 바이너리 모드로 대상 파일에서 정해진 길이만큼의 정보를 읽어들이는 함수

* 함수 프로토 타입

	```C
	size_t fread(void *buffer, size_t size, size_t count, FILE *stream);
	```

* 인자

	* buffer : 파일에서 읽어들인 내용을 저장할 버퍼의 주소

	* size : 한번에 읽을 메모리 블록의 크기

	* count : 읽어들일 메모리 블록의 수

	* stream : FILE 구조체에 대한 포인터

* 반환값 : 함수 성공 시 읽어들인 메모리 블록 수를 반환함

### fgets() 또는 fgets_s() 함수 : 대상 파일에서 문자열 한 줄을 읽어 들이는 입력 함수

* 함수 프로토 타입

	```C
	char *fgets(char *string, int n, FILE *stream);
	```

* 인자

	* string : 읽어 들인 문자열이 저장될 버퍼의 주소

	* n : 입력 버퍼의 바이트 단위 크기

	* stream : FILE 구조체에 대한 포인터

* 반환값

	* 정상 : string 인자로 전달된 주소

	* 에러 : NULL


## 04 > 입출력 정보 초기화 함수

### fflush() 함수 : 파일에 대한 입출력 완료 후 파일 입출력 관련 정보 초기화 (메모리 초기화는 아님)

* scanf() 함수나 gets() 함수를 이용해 표준입력장치로 정보를 입력받을 때, 개행 문자가 입출력 버퍼에 남아서 오류가 발생하는 경우를 해결하기 위해 사용함

* fflsh() 함수는 출력 스트림을 플러싱(flushing)하는 기능만 제공한다고 봐야 한다.

	* 입출력 정보의 초기화는 카운터 값을 초기화하는 것에 불과함

## 05 > 파일 위치 제어 함수

* 파일 입출력 포인터는 파일에서 입출력이 발생하는 위치를 저장하고 있는 포인터이다.

* 파일 포인터는 파일을 열었을 때 맨 앞에 존재하며, 입출력이 발생한 길이만큼 증가하게 된다.

* 포인터의 위치가 파일 데이터의 중간에 위치한 상태에서 쓰기가 진행될 경우 기존 파일의 내용은 덮어지게 된다.

* 파일의 쓰기가 기존의 파일 데이터의 최대 길이보다 늘어날 경우 파일의 길이는 자동으로 증가하게 된다.

### fseek(), rewind() : 파일 내에서 위치를 이동함

### ftell() : 파일 내의 현재 위치를 반환

## 06 > 그 외 알아두면 좋은 함수

### feof() : 파일 포인터가 맨 끝에 있는지 여부 확인 함수

### _access() : 특정 파일이 존재하는지, 어떤 전용 모드인지 확인하는 함수